<div class="container mx-auto mt-6 text-center">
  <h2 class="text-3xl font-bold mb-2 text-logo">実績確認</h2>
  <p class="text-gray-600 mb-6">各カテゴリーの達成状況を確認しましょう</p>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <% CarebitAction.categories.keys.each do |cat| %>
      <div class="bg-white shadow rounded-lg p-4 text-center">
        <h3 class="font-semibold mb-2"><%= category_labels[cat] %></h3>
        <%= image_tag "#{cat}.png", class: "mx-auto h-16 w-16 mb-2" %>

        <!-- Chartkick ドーナツグラフ -->
        <%= pie_chart(
          {
            "達成" => @stats[cat] || 0,
            "未達成" => ((@totals[cat] || 0) - (@stats[cat] || 0))
          },
          donut: true,
          height: "150px",
          colors: ["#f97316", "#d1d5db"],
          library: {
            cutout: "70%",
            plugins: {
              legend: { display: false },
              tooltip: { enabled: false },
              centerText: {
                display: true,
                text: "#{@stats[cat] || 0}/#{@totals[cat] || 0}"
              }
            }
          },
          raw: true
        ) %>
      </div>
    <% end %>
  </div>

  <!-- 集計期間切替 -->
  <div class="flex justify-center mt-6 text-gray-700">
    <%= link_to "全期間", achievements_path(period: "all"), class: "hover:underline" %>
    <span class="mx-2">｜</span>
    <%= link_to "今月", achievements_path(period: "month"), class: "hover:underline" %>
  </div>

  <!-- マイページに戻るボタン -->
  <div class="flex justify-center mt-8">
    <%= link_to "マイページに戻る", mypage_path, class: "btn" %>
  </div>
</div>
